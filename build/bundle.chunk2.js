(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{5:function(e,t,i){"use strict";i.r(t);var a=i(1),s=i.n(a),n=i(6),r=i(7),o=i.n(r),h=i(2);class l extends n.Object3D{constructor(e,t){super(),s()(this,"model",null),s()(this,"box",new n.Box3),s()(this,"size",new n.Vector3),s()(this,"center",new n.Vector3),s()(this,"currentWall",null),s()(this,"currentStage",null),s()(this,"currentHole",null),s()(this,"setCurrentWall",e=>{if(this.currentWall&&this.currentHole&&this.currentWall!==e&&(this.currentWall.removeHole(this.currentHole),this.currentWall.remove(this)),this.currentWall!==e&&e){this.currentWall=e,this.currentWall.add(this),-1===e.objects.indexOf(this)&&e.objects.push(this);let t=this.position.clone();this.currentHole=e.addHole(t,this.size,-this.box.min.z)}}),s()(this,"clone",()=>new l(this.model,this.box)),this.model=e.clone(),this.add(this.model),t?this.box.copy(t):this.box.setFromObject(this.model),this.box.getSize(this.size),this.box.getCenter(this.center)}}var c=l,u=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,i=/^usemtl /;function a(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var i=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);var a={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==i?i.smooth:this.smooth,groupStart:void 0!==i?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var i=this.materials.length-1;i>=0;i--)this.materials[i].groupCount<=0&&this.materials.splice(i,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},i&&i.name&&"function"==typeof i.clone){var a=i.clone(0);a.inherited=!0,this.object.materials.push(a)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseNormalIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseUVIndex:function(e,t){var i=parseInt(e,10);return 2*(i>=0?i-1:i+t/2)},addVertex:function(e,t,i){var a=this.vertices,s=this.object.geometry.vertices;s.push(a[e+0],a[e+1],a[e+2]),s.push(a[t+0],a[t+1],a[t+2]),s.push(a[i+0],a[i+1],a[i+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){var a=this.normals,s=this.object.geometry.normals;s.push(a[e+0],a[e+1],a[e+2]),s.push(a[t+0],a[t+1],a[t+2]),s.push(a[i+0],a[i+1],a[i+2])},addColor:function(e,t,i){var a=this.colors,s=this.object.geometry.colors;s.push(a[e+0],a[e+1],a[e+2]),s.push(a[t+0],a[t+1],a[t+2]),s.push(a[i+0],a[i+1],a[i+2])},addUV:function(e,t,i){var a=this.uvs,s=this.object.geometry.uvs;s.push(a[e+0],a[e+1]),s.push(a[t+0],a[t+1]),s.push(a[i+0],a[i+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,a,s,n,r,o,h){var l=this.vertices.length,c=this.parseVertexIndex(e,l),u=this.parseVertexIndex(t,l),d=this.parseVertexIndex(i,l);if(this.addVertex(c,u,d),this.colors.length>0&&this.addColor(c,u,d),void 0!==a&&""!==a){var m=this.uvs.length;c=this.parseUVIndex(a,m),u=this.parseUVIndex(s,m),d=this.parseUVIndex(n,m),this.addUV(c,u,d)}if(void 0!==r&&""!==r){var p=this.normals.length;c=this.parseNormalIndex(r,p),u=r===o?c:this.parseNormalIndex(o,p),d=r===h?c:this.parseNormalIndex(h,p),this.addNormal(c,u,d)}},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,i=0,a=e.length;i<a;i++)this.addVertexPoint(this.parseVertexIndex(e[i],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var i=this.vertices.length,a=this.uvs.length,s=0,n=e.length;s<n;s++)this.addVertexLine(this.parseVertexIndex(e[s],i));var r=0;for(n=t.length;r<n;r++)this.addUVLine(this.parseUVIndex(t[r],a))}};return e.startObject("",!1),e}function s(e){n.Loader.call(this,e),this.materials=null}return s.prototype=Object.assign(Object.create(n.Loader.prototype),{constructor:s,load:function(e,t,i,a){var s=this,r=new n.FileLoader(s.manager);r.setPath(this.path),r.load(e,(function(e){t(s.parse(e))}),i,a)},setMaterials:function(e){return this.materials=e,this},parse:function(s){var r=new a;-1!==s.indexOf("\r\n")&&(s=s.replace(/\r\n/g,"\n")),-1!==s.indexOf("\\\n")&&(s=s.replace(/\\\n/g,""));for(var o=s.split("\n"),h="",l="",c=[],u="function"==typeof"".trimLeft,d=0,m=o.length;d<m;d++)if(h=o[d],0!==(h=u?h.trimLeft():h.trim()).length&&"#"!==(l=h.charAt(0)))if("v"===l){var p=h.split(/\s+/);switch(p[0]){case"v":r.vertices.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])),p.length>=7&&r.colors.push(parseFloat(p[4]),parseFloat(p[5]),parseFloat(p[6]));break;case"vn":r.normals.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3]));break;case"vt":r.uvs.push(parseFloat(p[1]),parseFloat(p[2]))}}else if("f"===l){for(var g=h.substr(1).trim().split(/\s+/),f=[],v=0,b=g.length;v<b;v++){var w=g[v];if(w.length>0){var y=w.split("/");f.push(y)}}var x=f[0];for(v=1,b=f.length-1;v<b;v++){var M=f[v],S=f[v+1];r.addFace(x[0],M[0],S[0],x[1],M[1],S[1],x[2],M[2],S[2])}}else if("l"===l){var E=h.substring(1).trim().split(" "),P=[],z=[];if(-1===h.indexOf("/"))P=E;else for(var j=0,L=E.length;j<L;j++){var V=E[j].split("/");""!==V[0]&&P.push(V[0]),""!==V[1]&&z.push(V[1])}r.addLineGeometry(P,z)}else if("p"===l){var C=h.substr(1).trim().split(" ");r.addPointGeometry(C)}else if(null!==(c=e.exec(h))){var D=(" "+c[0].substr(1).trim()).substr(1);r.startObject(D)}else if(i.test(h))r.object.startMaterial(h.substring(7).trim(),r.materialLibraries);else if(t.test(h))r.materialLibraries.push(h.substring(7).trim());else{if("s"!==l){if("\0"===h)continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+h+'"')}if((c=h.split(" ")).length>1){var O=c[1].trim().toLowerCase();r.object.smooth="0"!==O&&"off"!==O}else r.object.smooth=!0;(Y=r.object.currentMaterial())&&(Y.smooth=r.object.smooth)}r.finalize();var R=new n.Group;R.materialLibraries=[].concat(r.materialLibraries);for(d=0,m=r.objects.length;d<m;d++){var A=r.objects[d],T=A.geometry,_=A.materials,I="Line"===T.type,H="Points"===T.type,F=!1;if(0!==T.vertices.length){var U=new n.BufferGeometry;U.addAttribute("position",new n.Float32BufferAttribute(T.vertices,3)),T.normals.length>0?U.addAttribute("normal",new n.Float32BufferAttribute(T.normals,3)):U.computeVertexNormals(),T.colors.length>0&&(F=!0,U.addAttribute("color",new n.Float32BufferAttribute(T.colors,3))),T.uvs.length>0&&U.addAttribute("uv",new n.Float32BufferAttribute(T.uvs,2));for(var k,W=[],B=0,N=_.length;B<N;B++){var G=_[B],Y=void 0;if(null!==this.materials)if(Y=this.materials.create(G.name),!I||!Y||Y instanceof n.LineBasicMaterial){if(H&&Y&&!(Y instanceof n.PointsMaterial)){var Z=new n.PointsMaterial({size:10,sizeAttenuation:!1});n.Material.prototype.copy.call(Z,Y),Z.color.copy(Y.color),Z.map=Y.map,Y=Z}}else{var X=new n.LineBasicMaterial;n.Material.prototype.copy.call(X,Y),X.color.copy(Y.color),Y=X}Y||((Y=I?new n.LineBasicMaterial:H?new n.PointsMaterial({size:1,sizeAttenuation:!1}):new n.MeshPhongMaterial).name=G.name),Y.flatShading=!G.smooth,Y.vertexColors=F?n.VertexColors:n.NoColors,W.push(Y)}if(W.length>1){for(B=0,N=_.length;B<N;B++){G=_[B];U.addGroup(G.groupStart,G.groupCount,B)}k=I?new n.LineSegments(U,W):H?new n.Points(U,W):new n.Mesh(U,W)}else k=I?new n.LineSegments(U,W[0]):H?new n.Points(U,W[0]):new n.Mesh(U,W[0]);k.name=A.name,R.add(k)}}return R}}),s}();const d={env:new n.CubeTexture,textures:{},materials:{},models:{}},m=new u,p=((()=>{const e=new n.MeshBasicMaterial,t=new n.PlaneBufferGeometry,i=new n.Scene;i.add(new n.Mesh(t,e));const a=new n.Camera,s=new n.WebGLRenderer})(),e=>new Promise((t,i)=>{fetch(e).then(e=>e.blob()).then(e=>{let i=document.createElement("img");i.onload=()=>t(i),i.src=URL.createObjectURL(e)}).catch(i)})),g=(e=(()=>{}))=>fetch("./"+o.a.resolve(h.a.assetsPath,"resources.json")).then(e=>e.json()).then(t=>((e,t)=>{let i=e.map((e,t)=>p("./"+o.a.resolve(h.a.assetsPath,e)));return t({message:"Loading environment maps..."}),Promise.all(i).then(e=>(d.env.image=e,d.env.needsUpdate=!0,Promise.resolve()))})(t.maps.env,e).then(()=>((e,t)=>{let i,a={},s=[],r=Object.keys(e),l=0;for(let c of r){a[c]={},d.textures[c]={},i=Object.keys(e[c]);for(let a of i){let u=p("./"+o.a.resolve(h.a.assetsPath,e[c][a])).then(e=>{d.textures[c][a]=new n.Texture(e,void 0,n.RepeatWrapping,n.RepeatWrapping),t({message:`Loading textures ${++l} of ${r.length*i.length}`}),d.textures[c][a].needsUpdate=!0});s.push(u)}}return Promise.all(s)})(t.maps.textures,e)).then(()=>(e=>{let t,i,a=Object.keys(e);for(let s of a){d.materials[s]={...e[s],name:s,object:new n.MeshPhysicalMaterial({side:n.DoubleSide,envMap:d.env,transparent:!0,alphaTest:.1,color:e[s].color||"white"})},t=d.textures[e[s].maps],i=d.materials[s].object,t&&(i.map=t.diffuse||null,i.normalMap=t.normal||null);let a=d.materials[s].object;e[s].isGlass?(a.roughness=.045,a.metalness=.75,a.needsUpdate=!0):e[s].isMetal?(a.roughness=.025,a.metalness=.75,a.reflectivity=.4,a.needsUpdate=!0):(a.roughness=.75,a.metalness=.2,a.reflectivity=0,a.needsUpdate=!0)}return Promise.resolve()})(t.materials)).then(()=>((e,t,i)=>{let a,s=Object.keys(e),r=[],l=0;i({message:`Loading models ${l} of ${s.length}`});for(let c of s)a=e[c],r.push(new Promise((e,r)=>{m.load("./"+o.a.resolve(h.a.assetsPath,a),a=>{i({message:`Loading models ${++l} of ${s.length}`}),a.rotateY(.5*Math.PI),a.traverse(e=>{e instanceof n.Mesh&&(e.name.match(/glass/i)?e.material=d.materials.DefaultGlass.object.clone():e.material=d.materials.DefaultPlastic.object.clone())}),d.models[c]=new t(a),e()},void 0,r)}));return Promise.all(r)})(t.models.windows,c,e)));var f=i(0);n.ShaderChunk.alphamap_fragment=n.ShaderChunk.alphamap_fragment.replace("vUv","vUv2"),n.ShaderChunk.uv2_vertex=n.ShaderChunk.uv2_vertex.replace("defined( USE_LIGHTMAP )","defined( USE_LIGHTMAP ) || defined( USE_ALPHAMAP )"),n.ShaderChunk.uv2_pars_fragment=n.ShaderChunk.uv2_pars_fragment.replace("defined( USE_LIGHTMAP )","defined( USE_LIGHTMAP ) || defined( USE_ALPHAMAP )"),n.ShaderChunk.uv2_pars_vertex=n.ShaderChunk.uv2_pars_vertex.replace("defined( USE_LIGHTMAP )","defined( USE_LIGHTMAP ) || defined( USE_ALPHAMAP )");class v extends n.Object3D{constructor(e,t){super(),s()(this,"size",null),s()(this,"isBuildingPlane",!0),this.size=new n.Vector2(e,t),this.geometry=new n.PlaneBufferGeometry(e,t);let i=new n.MeshPhysicalMaterial({color:16777215,side:n.DoubleSide,envMap:d.env}),a=this.geometry.attributes.uv.array.slice(0);this.geometry.addAttribute("uv2",new n.BufferAttribute(a,2)),this.mesh=new n.Mesh(this.geometry,i),this.mesh.receiveShadow=!0,this.mesh.castShadow=!0,this.receiveShadow=!0,this.castShadow=!0,this.add(this.mesh),this.setSize(e,t),this.material=null}clone(){let e=new v(this.size.x,this.size.y);return e.position.copy(this.position),e.rotation.copy(this.rotation),e.scale.copy(this.scale),this.material&&e.setMaterial(this.material),e}setSize(e,t){this.size.set(e||this.size.x,t||this.size.y),this.geometry.parameters.width=this.size.x,this.geometry.parameters.height=this.size.y;let i=this.geometry.attributes.position.array;for(let e=0;e<i.length;e+=3)i[e]=i[e]<=0?0:this.size.x,i[e+1]=i[e+1]<=0?0:this.size.y;this.material&&this.setUVRepeat(this.material.mapping[0]*this.size.x,this.material.mapping[1]*this.size.y)}setMaterial(e=null){this.material=e?{...e}:this.material,this.mesh.material=this.material.object.clone(),this.setUVRepeat(this.material.mapping[0]*this.size.x,this.material.mapping[1]*this.size.y),this.dispatchEvent({type:f.a})}setUVRepeat(e=1,t=1){let i=this.geometry.attributes.uv.array,a=this.geometry.attributes.uv2.array;for(let s=0;s<i.length;s+=2)i[s]=i[s]<=0?0:e,i[s+1]=i[s+1]<=0?0:t,a[s]=a[s]<=0?0:1,a[s+1]=a[s+1]<=0?0:1;this.geometry.attributes.uv.needsUpdate=!0,this.geometry.attributes.uv2.needsUpdate=!0}}class b extends n.Object3D{constructor(e,t,i){super(),this.size=new n.Vector3(e,t,i),this.geometry=new n.BoxBufferGeometry(e,t,i);let a=new n.MeshPhysicalMaterial({color:16777215,side:n.DoubleSide,envMap:d.env});this.UVOrigin=this.geometry.attributes.uv.array.slice(0);let s=this.geometry.attributes.uv.array;this.geometry.addAttribute("uv2",new n.BufferAttribute(s,2)),this.mesh=new n.Mesh(this.geometry,a),this.add(this.mesh),this.material=null}setSize(e,t,i){this.size.set(e||this.size.x,t||this.size.y,i||this.size.z),this.mesh.geometry=new n.BoxBufferGeometry(this.size.x,this.size.y,this.size.z),this.setUVRepeat(this.material.mapping[0]*this.size.x,this.material.mapping[1]*this.size.y)}setMaterial(e=null){this.material=e||this.material,this.mesh.material=this.material.object.clone(),this.setUVRepeat(this.material.mapping[0]*this.size.x,this.material.mapping[1]*this.size.y),this.dispatchEvent({type:f.a})}setUVRepeat(e=1,t=1){for(let i=0;i<2*this.geometry.attributes.uv.count;i+=2)if(this.mesh.geometry.attributes.uv.array[i]=this.UVOrigin[i]/(1/e),this.mesh.geometry.attributes.uv.array[i+1]=this.UVOrigin[i+1]/(1/t),this.mesh.geometry.attributes.uv2)this.mesh.geometry.attributes.uv2.array[i]=this.mesh.geometry.attributes.uv.array[i],this.mesh.geometry.attributes.uv2.array[i+1]=this.mesh.geometry.attributes.uv.array[i+1];else{let e=this.mesh.geometry.attributes.uv.array;this.mesh.geometry.addAttribute("uv2",new n.BufferAttribute(e,2))}}}const w=(e,t,i)=>{let a=new v(e,t);return i&&a.setMaterial(i),a},y=(e,t,i,a)=>{let s=new b(e,t,i);return a&&s.setMaterial(a),s},x=e=>{e.traverse(e=>{e instanceof n.Mesh&&(e.material.roughness=.025,e.material.metalness=.75,e.material.needsUpdate=!0)})},M=e=>{e.traverse(e=>{e instanceof n.Mesh&&(e.material.roughness=.75,e.material.metalness=.2,e.material.reflectivity=0,e.material.needsUpdate=!0)})},S=(e,t)=>{e.material.map=t.diffuse||null,e.material.normalMap=t.normal||null,e.material.roughnessMap=t.roughness||null,e.material.aoMap=t.ao||null};class E extends n.Object3D{constructor(){super(),s()(this,"light",new n.AmbientLight(15788768,1)),s()(this,"dirLight",new n.DirectionalLight(8421522,1)),this.add(this.light),this.add(this.dirLight),this.dirLight.shadow.bias=-.008,this.dirLight.shadow.camera.far=1e4,this.dirLight.shadow.mapSize.width=2048,this.dirLight.shadow.mapSize.height=2048,this.dirLight.castShadow=!0,this.add(this.dirLight.target),this.dirLight.target.position.set(1e3,0,0)}}var P=E,z=i(9),j=i.n(z);let L=function(){let e=L.SkyShader,t=new n.ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:n.UniformsUtils.clone(e.uniforms),side:n.BackSide});n.Mesh.call(this,new n.BoxBufferGeometry(1,1,1),t)};L.prototype=Object.create(n.Mesh.prototype),L.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new n.Vector3},up:{value:new n.Vector3(0,1,0)}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","uniform vec3 up;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tgl_Position.z = gl_Position.w;","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","uniform vec3 up;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")};var V=i(3);const C=function(e,t){var i,a,s,r,o;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new n.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:n.MOUSE.LEFT,MIDDLE:n.MOUSE.MIDDLE,RIGHT:n.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return g.phi},this.getAzimuthalAngle=function(){return g.theta},this.saveState=function(){h.target0.copy(h.target),h.position0.copy(h.object.position),h.zoom0=h.object.zoom},this.reset=function(){h.target.copy(h.target0),h.object.position.copy(h.position0),h.object.zoom=h.zoom0,h.object.updateProjectionMatrix(),h.dispatchEvent(l),h.update(),m=d.NONE},this.update=(i=new n.Vector3,a=(new n.Quaternion).setFromUnitVectors(e.up,new n.Vector3(0,1,0)),s=a.clone().inverse(),r=new n.Vector3,o=new n.Quaternion,function(){var e=h.object.position;return i.copy(e).sub(h.target),i.applyQuaternion(a),g.setFromVector3(i),h.autoRotate&&m===d.NONE&&C(2*Math.PI/60/60*h.autoRotateSpeed),g.theta+=f.theta,g.phi+=f.phi,g.theta=Math.max(h.minAzimuthAngle,Math.min(h.maxAzimuthAngle,g.theta)),g.phi=Math.max(h.minPolarAngle,Math.min(h.maxPolarAngle,g.phi)),g.makeSafe(),g.radius*=v,g.radius=Math.max(h.minDistance,Math.min(h.maxDistance,g.radius)),h.target.add(b),i.setFromSpherical(g),i.applyQuaternion(s),e.copy(h.target).add(i),h.object.lookAt(h.target),!0===h.enableDamping?(f.theta*=1-h.dampingFactor,f.phi*=1-h.dampingFactor,b.multiplyScalar(1-h.dampingFactor)):(f.set(0,0,0),b.set(0,0,0)),v=1,!!(w||r.distanceToSquared(h.object.position)>p||8*(1-o.dot(h.object.quaternion))>p)&&(h.dispatchEvent(l),r.copy(h.object.position),o.copy(h.object.quaternion),w=!1,!0)}),this.clampInstance=(e,t=null)=>{let i=(new n.Box3).setFromObject(e),a=new n.Sphere;i.getBoundingSphere(a),a.applyMatrix4(e.matrixWorld);let s=(new n.Vector3).subVectors(this.object.position,this.target),r=a.radius/Math.tan(this.object.fov/2*Math.PI/180),o=(new n.Vector3).addVectors(a.center,s.setLength(r));if(this.object.position.copy(o),this.target.copy(a.center),!t)return!1;let h=2*a.radius;t.shadow.camera.far=3*a.radius,t.shadow.camera.left=-h,t.shadow.camera.right=h,t.shadow.camera.top=h,t.shadow.camera.bottom=-h,t.position.set(i.max.x,1.5*i.max.y,2*i.min.z),t.target.position.copy(i.min.clone()).setZ(0),t.castShadow=!0},this.clampLight=(e,t)=>{let i=(new n.Box3).setFromObject(e),a=new n.Sphere;i.getBoundingSphere(a),a.applyMatrix4(e.matrixWorld);let s=2*a.radius;t.shadow.camera.far=3*a.radius,t.shadow.camera.left=-s,t.shadow.camera.right=s,t.shadow.camera.top=s,t.shadow.camera.bottom=-s,t.shadow.camera.updateProjectionMatrix(),t.position.copy(i.max.clone().normalize()).setY(i.max.y),t.shadow.camera.position.set(i.max.x,i.max.y,i.max.z),t.castShadow=!0},this.dispose=function(){h.domElement.removeEventListener("contextmenu",Z,!1),h.domElement.removeEventListener("mousedown",F,!1),h.domElement.removeEventListener("wheel",W,!1),h.domElement.removeEventListener("touchstart",N,!1),h.domElement.removeEventListener("touchend",Y,!1),h.domElement.removeEventListener("touchmove",G,!1),document.removeEventListener("mousemove",U,!1),document.removeEventListener("mouseup",k,!1),window.removeEventListener("keydown",B,!1)};var h=this,l={type:"change"},c={type:"start"},u={type:"end"},d={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},m=d.NONE,p=1e-6,g=new n.Spherical,f=new n.Spherical,v=1,b=new n.Vector3,w=!1,y=new n.Vector2,x=new n.Vector2,M=new n.Vector2,S=new n.Vector2,E=new n.Vector2,P=new n.Vector2,z=new n.Vector2,j=new n.Vector2,L=new n.Vector2;function V(){return Math.pow(.95,h.zoomSpeed)}function C(e){f.theta-=e}function D(e){f.phi-=e}var O,R=(O=new n.Vector3,function(e,t){O.setFromMatrixColumn(t,0),O.multiplyScalar(-e),b.add(O)}),A=function(){var e=new n.Vector3;return function(t,i){!0===h.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(h.object.up,e)),e.multiplyScalar(t),b.add(e)}}(),T=function(){var e=new n.Vector3;return function(t,i){var a=h.domElement===document?h.domElement.body:h.domElement;if(h.object.isPerspectiveCamera){var s=h.object.position;e.copy(s).sub(h.target);var n=e.length();n*=Math.tan(h.object.fov/2*Math.PI/180),R(2*t*n/a.clientHeight,h.object.matrix),A(2*i*n/a.clientHeight,h.object.matrix)}else h.object.isOrthographicCamera?(R(t*(h.object.right-h.object.left)/h.object.zoom/a.clientWidth,h.object.matrix),A(i*(h.object.top-h.object.bottom)/h.object.zoom/a.clientHeight,h.object.matrix)):h.enablePan=!1}}();function _(e){h.object.isPerspectiveCamera?v/=e:h.object.isOrthographicCamera?(h.object.zoom=Math.max(h.minZoom,Math.min(h.maxZoom,h.object.zoom*e)),h.object.updateProjectionMatrix(),w=!0):h.enableZoom=!1}function I(e){h.object.isPerspectiveCamera?v*=e:h.object.isOrthographicCamera?(h.object.zoom=Math.max(h.minZoom,Math.min(h.maxZoom,h.object.zoom/e)),h.object.updateProjectionMatrix(),w=!0):h.enableZoom=!1}function H(e){S.set(e.clientX,e.clientY)}function F(e){if(!1!==h.enabled){switch(e.preventDefault(),h.domElement.focus?h.domElement.focus():window.focus(),e.button){case h.mouseButtons.LEFT:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===h.enablePan)return;H(e),m=d.PAN}else{if(!1===h.enableRotate)return;!function(e){y.set(e.clientX,e.clientY)}(e),m=d.ROTATE}break;case h.mouseButtons.MIDDLE:if(!1===h.enableZoom)return;!function(e){z.set(e.clientX,e.clientY)}(e),m=d.DOLLY;break;case h.mouseButtons.RIGHT:if(!1===h.enablePan)return;H(e),m=d.PAN}m!==d.NONE&&(document.addEventListener("mousemove",U,!1),document.addEventListener("mouseup",k,!1),h.dispatchEvent(c))}}function U(e){if(!1!==h.enabled)switch(e.preventDefault(),m){case d.ROTATE:if(!1===h.enableRotate)return;!function(e){x.set(e.clientX,e.clientY),M.subVectors(x,y).multiplyScalar(h.rotateSpeed);var t=h.domElement===document?h.domElement.body:h.domElement;C(2*Math.PI*M.x/t.clientHeight),D(2*Math.PI*M.y/t.clientHeight),y.copy(x),h.update()}(e);break;case d.DOLLY:if(!1===h.enableZoom)return;!function(e){j.set(e.clientX,e.clientY),L.subVectors(j,z),L.y>0?_(V()):L.y<0&&I(V()),z.copy(j),h.update()}(e);break;case d.PAN:if(!1===h.enablePan)return;!function(e){E.set(e.clientX,e.clientY),P.subVectors(E,S).multiplyScalar(h.panSpeed),T(P.x,P.y),S.copy(E),h.update()}(e)}}function k(e){!1!==h.enabled&&(document.removeEventListener("mousemove",U,!1),document.removeEventListener("mouseup",k,!1),h.dispatchEvent(u),m=d.NONE)}function W(e){!1===h.enabled||!1===h.enableZoom||m!==d.NONE&&m!==d.ROTATE||(e.preventDefault(),e.stopPropagation(),h.dispatchEvent(c),function(e){e.deltaY<0?I(V()):e.deltaY>0&&_(V()),h.update()}(e),h.dispatchEvent(u))}function B(e){!1!==h.enabled&&!1!==h.enableKeys&&!1!==h.enablePan&&function(e){switch(e.preventDefault(),e.keyCode){case h.keys.UP:T(0,h.keyPanSpeed),h.update();break;case h.keys.BOTTOM:T(0,-h.keyPanSpeed),h.update();break;case h.keys.LEFT:T(h.keyPanSpeed,0),h.update();break;case h.keys.RIGHT:T(-h.keyPanSpeed,0),h.update()}}(e)}function N(e){if(!1!==h.enabled){switch(e.preventDefault(),e.touches.length){case 1:if(!1===h.enableRotate)return;!function(e){y.set(e.touches[0].pageX,e.touches[0].pageY)}(e),m=d.TOUCH_ROTATE;break;case 2:if(!1===h.enableZoom&&!1===h.enablePan)return;!function(e){if(h.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+i*i);z.set(0,a)}if(h.enablePan){var s=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);S.set(s,n)}}(e),m=d.TOUCH_DOLLY_PAN;break;default:m=d.NONE}m!==d.NONE&&h.dispatchEvent(c)}}function G(e){if(!1!==h.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===h.enableRotate)return;if(m!==d.TOUCH_ROTATE)return;!function(e){x.set(e.touches[0].pageX,e.touches[0].pageY),M.subVectors(x,y).multiplyScalar(h.rotateSpeed);var t=h.domElement===document?h.domElement.body:h.domElement;C(2*Math.PI*M.x/t.clientHeight),D(2*Math.PI*M.y/t.clientHeight),y.copy(x),h.update()}(e);break;case 2:if(!1===h.enableZoom&&!1===h.enablePan)return;if(m!==d.TOUCH_DOLLY_PAN)return;!function(e){if(h.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+i*i);j.set(0,a),L.set(0,Math.pow(j.y/z.y,h.zoomSpeed)),_(L.y),z.copy(j)}if(h.enablePan){var s=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);E.set(s,n),P.subVectors(E,S).multiplyScalar(h.panSpeed),T(P.x,P.y),S.copy(E)}h.update()}(e);break;default:m=d.NONE}}function Y(e){!1!==h.enabled&&(h.dispatchEvent(u),m=d.NONE)}function Z(e){!1!==h.enabled&&e.preventDefault()}h.domElement.addEventListener("contextmenu",Z,!1),h.domElement.addEventListener("mousedown",F,!1),h.domElement.addEventListener("wheel",W,!1),h.domElement.addEventListener("touchstart",N,!1),h.domElement.addEventListener("touchend",Y,!1),h.domElement.addEventListener("touchmove",G,!1),window.addEventListener("keydown",B,!1),this.update()};(C.prototype=Object.create(n.EventDispatcher.prototype)).constructor=C,Object.defineProperties(C.prototype,{center:{get:function(){return this.target}},noZoom:{get:function(){return!this.enableZoom},set:function(e){this.enableZoom=!e}},noRotate:{get:function(){return!this.enableRotate},set:function(e){this.enableRotate=!e}},noPan:{get:function(){return!this.enablePan},set:function(e){this.enablePan=!e}},noKeys:{get:function(){return!this.enableKeys},set:function(e){this.enableKeys=!e}},staticMoving:{get:function(){return!this.enableDamping},set:function(e){this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return this.dampingFactor},set:function(e){this.dampingFactor=e}}});var D=C;const O=e=>2.54*e,R=e=>30.48*e,A=e=>100*e,T=e=>1e5*e,_=e=>12*e,I=e=>e/12;class H extends n.Object3D{constructor(){super(),s()(this,"plane",w(T(.5),T(.5),d.materials.DefaultGround)),this.plane.rotation.x=.5*-Math.PI,this.plane.position.set(T(-.25),0,T(.25)),this.plane.setMaterial(),M(this.plane.mesh),this.add(this.plane),this.receiveShadow=!0}}var F=H;class U extends n.Object3D{constructor(e=new n.Vector2(1,1),t=new n.Vector3,i=new n.Vector3,a){super(),s()(this,"plane",w(1,1,d.materials.DefaultWall)),s()(this,"aspect",new n.Vector2(1,1)),s()(this,"alphaMapCanvas",document.createElement("canvas")),s()(this,"alphaMapContext",this.alphaMapCanvas.getContext("2d")),s()(this,"alphaMap",new n.CanvasTexture(this.alphaMapCanvas,void 0,n.RepeatWrapping,n.RepeatWrapping)),s()(this,"holes",[]),s()(this,"objects",[]),s()(this,"holeContainer",new n.Object3D),s()(this,"isWall",!0),s()(this,"updateAlphaMap",()=>{let e,t,i,a;this.alphaMapContext=this.alphaMapCanvas.getContext("2d"),this.alphaMapCanvas.width=n.Math.ceilPowerOfTwo(this.plane.size.x/O(1)),this.alphaMapCanvas.height=n.Math.ceilPowerOfTwo(this.plane.size.y/O(1)),this.aspect=this.alphaMapCanvas.width/this.alphaMapCanvas.height,this.alphaMapContext.fillStyle="rgba(255, 255, 255, 1.0)",this.alphaMapContext.fillRect(0,0,this.alphaMapCanvas.width,this.alphaMapCanvas.height),this.alphaMapContext.fillStyle="rgba(0, 0, 0, 1.0)";for(let s of this.holes)e=Math.ceil(s.size.x/this.plane.size.x*this.alphaMapCanvas.width)-1,t=Math.ceil(s.size.y/this.plane.size.y*this.alphaMapCanvas.height)-1,i=Math.ceil(s.position.x/this.plane.size.x*this.alphaMapCanvas.width),a=Math.ceil(s.position.y/this.plane.size.y*this.alphaMapCanvas.height),this.alphaMapContext.fillRect(i,this.alphaMapCanvas.height-a,e,t);this.plane.mesh.material.alphaMap=this.alphaMap,this.plane.mesh.material.alphaMap.needsUpdate=!0,this.plane.mesh.material.needsUpdate=!0}),s()(this,"addHole",(e,t,i)=>{let a=new n.Object3D,s=w(i,t.y,this.plane.material);s.rotation.set(0,.5*Math.PI,0),s.position.set(0,0,0);let r=s.clone();r.position.set(t.x,0,0);let o=w(t.x,i,this.plane.material);o.rotation.x=.5*Math.PI,o.position.set(0,t.y,-i);let h=o.clone();return h.position.set(0,0,-i),a.add(s),a.add(r),a.add(o),a.add(h),a.position.set(e.x,e.y-t.y,0),this.holes.push({position:e.clone(),size:t.clone(),depth:i,object:a,planes:[s,r,o,h]}),this.holeContainer.add(a),this.updateAlphaMap(),this.holes[this.holes.length-1]}),s()(this,"findNearestHoles",e=>{let t=null,i=null;for(let a of this.holes)a!==e&&(a.position.x<=e.position.x?(!t||t&&t.position.x<a.position.x)&&(t=a):a.position.x>=e.position.x&&(!i||i&&i.position.x>a.position.x)&&(i=a));return{left:t,right:i}}),s()(this,"moveHole",(e,t)=>{let i=this.getOrientedPos(t);e.object.position.set(i.x,i.y-e.size.y,0),e.position.set(i.x,i.y,0),this.updateAlphaMap()}),s()(this,"getOrientedPos",e=>{let t=(new n.Matrix4).getInverse(this.matrix);return e.clone().applyMatrix4(t)}),s()(this,"getRealPos",e=>e.clone().applyMatrix4(this.matrix)),s()(this,"removeHole",e=>{this.holes=this.holes.filter(t=>t!==e||(this.holeContainer.remove(t.object),!1)),this.updateAlphaMap()}),this.alphaMap.magFilter=n.NearestFilter,this.alphaMap.needsUpdate=!0,this.plane.addEventListener(f.a,()=>this.updateAlphaMap()),this.plane.setSize(e.x,e.y),this.add(this.plane),this.add(this.holeContainer),this.position.copy(t.clone()),this.rotation.set(i.x,i.y,i.z),a&&this.plane.setMaterial(a)}}var k=U;const W=561032,B=35071,N=0,G=2,Y=3;class Z extends n.Object3D{constructor(e,t,i,a){super(),s()(this,"isStage",!0),s()(this,"walls",[]),s()(this,"number",1),s()(this,"container",new n.Object3D),s()(this,"isSelected",!1),s()(this,"width",1),s()(this,"height",1),s()(this,"depth",1),s()(this,"baseMaterial",null),this.baseMaterial=a,this.add(this.container),this.setSize(e,t,i)}setSize(e,t,i){this.width=e,this.height=t,this.depth=i,this.generateStage()}setHeight(e){this.height=e,this.generateStage()}generateStage(){let e=this.width,t=this.height,i=this.depth,a=new k(new n.Vector2(e,t),new n.Vector3(0,0,0),new n.Vector3(0,0,0),this.walls.length?this.walls[0].material:this.baseMaterial),s=new k(new n.Vector2(i,t),new n.Vector3(e,0,0),new n.Vector3(0,.5*Math.PI,0),this.walls.length?this.walls[1].material:this.baseMaterial),r=new k(new n.Vector2(e,t),new n.Vector3(e,0,-i),new n.Vector3(0,Math.PI,0),this.walls.length?this.walls[2].material:this.baseMaterial),o=new k(new n.Vector2(i,t),new n.Vector3(0,0,-i),new n.Vector3(0,1.5*Math.PI,0),this.walls.length?this.walls[3].material:this.baseMaterial);for(this.walls=[a,s,r,o];this.container.children.length;)this.container.remove(this.container.children[0]);this.container.add(a),this.container.add(s),this.container.add(r),this.container.add(o)}set selected(e){this.traverse(t=>{t instanceof n.Mesh&&(t.material.emissive.set(e?B:0),t.material.emissiveIntensity=.05)}),this.isSelected=e}set hovered(e){if(this.isSelected)return!1;this.traverse(t=>{t instanceof n.Mesh&&(t.material.emissive.set(e?W:0),t.material.emissiveIntensity=.05)})}}var X=Z;const K=O(6),$=O(2);class q extends n.Object3D{constructor(e,t,i){super(),s()(this,"material",d.materials.DefaultFloor),s()(this,"walls",[]),this.material=i||this.material;let a=2*K,r=.5*Math.PI,o=Math.PI,h=new k(new n.Vector2(e,a),new n.Vector3(0,0,0),new n.Vector3(-r,0,0),this.material),l=new k(new n.Vector2(e,a),new n.Vector3(0,-a,-a),new n.Vector3(0,0,0),this.material),c=new k(new n.Vector2(e,a),new n.Vector3(e,0,-t),new n.Vector3(r,o,0),this.material),u=new k(new n.Vector2(e,a),new n.Vector3(e,-a,-t+a),new n.Vector3(0,o,0),this.material),m=new k(new n.Vector2(t,a),new n.Vector3(0,0,-t),new n.Vector3(r,o,r),this.material),p=new k(new n.Vector2(t,a),new n.Vector3(a,0,-t),new n.Vector3(r,r,r),this.material),g=new k(new n.Vector2(t,a),new n.Vector3(e,0,0),new n.Vector3(-r,0,r),this.material),f=new k(new n.Vector2(t,a),new n.Vector3(e-a,0,0),new n.Vector3(-r,-r,r),this.material),v=new k(new n.Vector2(e-2*a,t-2*a),new n.Vector3(a,-a,-a),new n.Vector3(-r,0,0),this.material);this.add(h),this.add(l),this.add(c),this.add(u),this.add(m),this.add(p),this.add(g),this.add(f),this.add(v),this.walls=this.children.slice(0)}}var Q=q;const J=(e,t,i)=>Math.max(e,Math.min(i,t)),ee=(e,t=O(12))=>{let i=e.clone().divideScalar(t);return i.set(Math.round(i.x),Math.round(i.y),Math.round(i.z)),i.multiplyScalar(t)},te=(e,t,i,a,s,n)=>{((e,t,i,a,s,n)=>{let r,o,h,l=a,c=s;e.beginPath(),r=Math.atan2(s-i,a-t),o=n*Math.cos(r)+l,h=n*Math.sin(r)+c,e.moveTo(o,h),r+=1/3*(2*Math.PI),o=n*Math.cos(r)+l,h=n*Math.sin(r)+c,e.lineTo(o,h),r+=1/3*(2*Math.PI),o=n*Math.cos(r)+l,h=n*Math.sin(r)+c,e.lineTo(o,h),e.closePath(),e.fill()})(e,t,i,a,s,n),((e,t,i,a,s)=>{e.beginPath(),e.moveTo(t,i),e.lineTo(a,s),e.closePath(),e.stroke()})(e,t,i,a,s)},ie=(e,t,i,a,s)=>{e.save(),e.translate(t,i),e.rotate(a),e.textAlign="center",e.fillText(s,0,0),e.restore()};class ae extends n.Object3D{constructor(e,t,i,a,r){super(),s()(this,"roof",null),s()(this,"walls",[]),s()(this,"stages",[]),s()(this,"windows",[]),s()(this,"doors",[]),s()(this,"objects",new Set),s()(this,"selectMode",Y),s()(this,"currentDrag",null),s()(this,"currentWall",null),s()(this,"currentStage",null),s()(this,"lastSelectedStage",null),s()(this,"selectedStage",null),s()(this,"mouseRealCoord",new n.Vector3),s()(this,"lastSelectedItem",null),s()(this,"selectedItem",null),s()(this,"stagesCount",0),s()(this,"defaultMaterial",d.materials.Default),s()(this,"defaultStageHeight",R(8)),s()(this,"defaultStageCount",2),s()(this,"width",R(40)),s()(this,"depth",R(16)),s()(this,"overallHeight",this.defaultStageCount*this.defaultStageHeight),s()(this,"_finishDrag",()=>{this.selectMode=Y,this._updateObjects(),this.setDrag(null)}),s()(this,"_updateObjects",()=>{this.objects=[],this.stages.forEach(e=>{e.walls.forEach(e=>{e.objects=e.objects.filter(t=>t.currentWall===e),this.objects=this.objects.concat(e.objects)})})}),s()(this,"setDrag",e=>{this.selectMode=e?G:Y,this.currentDrag=e}),s()(this,"getStage",e=>{for(let t of this.stages)if(t.number===e)return t}),s()(this,"removeSelectedStage",()=>{this.removeStage(this.selectedStage)}),s()(this,"setStageHeight",(e,t)=>{if(!e)return!1;e.setHeight(t),this._updateWalls(),this._updateOverallHeight()}),s()(this,"setStageMaterial",(e,t)=>{if(!e||!t)return!1;e.walls.forEach(e=>{e.plane.setMaterial(t),e.holes.forEach(e=>{e.planes.forEach(e=>{e.setMaterial(t)})})})}),s()(this,"setRoofMaterial",e=>{if(!e)return!1;this.roof.walls.forEach(t=>{t.plane.setMaterial(e)})}),s()(this,"_updateWalls",()=>{this.walls=this.stages.map(e=>e.walls.map(e=>e.plane)).flat()}),s()(this,"_updateOverallHeight",()=>{let e=0;for(let t of this.stages)t.position.y=e,e+=t.height;this.overallHeight=e,this._updateRoof()}),s()(this,"_updateRoof",()=>{this.roof.position.y=this.overallHeight}),s()(this,"removeStage",e=>{if(1===this.stages.length)return!1;let t=e.number;this.stages.splice(t,1);let i=0,a=0;for(let e of this.stages)e.position.y=a,e.number=i,a+=e.height,i+=1;this.stagesCount=i,this.remove(e),this.walls=this.stages.map(e=>e.walls.map(e=>e.plane)).flat(),this._updateOverallHeight()}),s()(this,"addStage",(e,t)=>{let i=new X(this.width,t||this.defaultStageHeight,this.depth,this.defaultMaterial);i.number=e,this.stages=this.stages.map((t,i)=>(t.number=i>=e?i+1:i,t)),this.stages.splice(e,0,i),this.add(i),this.walls=this.stages.map(e=>e.walls.map(e=>e.plane)).flat(),this._updateOverallHeight()}),s()(this,"_onMouseMove",e=>{switch(this.selectMode){case N:this._onSelectStage(e,this.hoverStage);break;case G:this._onItemDrag(e)}}),s()(this,"_onMouseDown",e=>{switch(this.selectMode){case N:this._onSelectStage(e,this.selectStage);break;case G:this._finishDrag()}}),s()(this,"_updateCurrentWall",e=>{let t=e.intersectObjects(this.walls,!0);if(this.currentWall=null,this.currentStage=null,t.length){let e=t[0].object;for(this.mouseRealCoord.copy(t[0].point);!e.isBuildingPlane&&null!==e.parent;)e=e.parent;if(!e.isBuildingPlane)return!1;for(;!e.isWall&&null!==e.parent;)e=e.parent;if(!e.isWall)return!1;for(this.currentWall=e;!e.isStage&&null!==e.parent;)e=e.parent;e.isStage&&(this.currentStage=e)}}),s()(this,"_onItemDrag",e=>{if(!this.currentDrag)return!1;if(this._updateCurrentWall(e),!this.currentWall)return this.currentDrag.setCurrentWall(null),!1;if(this.currentWall&&this.currentDrag.size.y>=this.currentWall.plane.size.y)return!1;this.currentDrag.setCurrentWall(this.currentWall);let t=this.mouseRealCoord.clone();t.set(t.x,t.y-this.currentStage.position.y,t.z);let i=this.currentWall.getOrientedPos(t);i.y-=this.currentDrag.size.y/2,(i=ee(i)).set(J(K+this.currentDrag.box.max.x,this.currentWall.plane.size.x-this.currentDrag.size.x-K-this.currentDrag.box.min.x,i.x),J(0,this.currentWall.plane.size.y-this.currentDrag.size.y-$,i.y),0),this.currentDrag.position.set(i.x,i.y,0),i.x=i.x+this.currentDrag.box.min.x,(t=this.currentWall.getRealPos(i)).y+=this.currentDrag.size.y,this.currentWall.moveHole(this.currentDrag.currentHole,t)}),s()(this,"_onSelectStage",(e,t)=>{let i=e.intersectObjects(this.stages,!0);if(i.length){let e=i[0].object;for(;!(e instanceof X)&&null!==e.parent;)e=e.parent;return e instanceof X?(t(e),!1):(t(null),!1)}t(null)}),s()(this,"selectStage",e=>{e&&(this.lastSelectedStage=this.selectedStage);for(let t of this.stages)t.selected=e===t;this.selectedStage=e,this.currentStage=e,this.dispatchEvent({type:f.b})}),s()(this,"hoverStage",e=>{for(let t of this.stages)t.hovered=e===t}),s()(this,"getWallPlan",(e,t,i)=>{let a,s,n,r=document.createElement("canvas"),o=r.getContext("2d");r.width=e.plane.size.x+48,r.height=e.plane.size.y+48,o.fillStyle="#ffffff",o.fillRect(0,0,r.width,r.height),o.fillStyle="#000000",o.strokeStyle="#000000",o.font="13px Arial",o.textAlign="center",o.textBaseline="bottom",o.strokeWidth=2,o.strokeRect(24,24,r.width-48,r.height-48),ie(o,.5*r.width,24,0,(e.plane.size.x/30.48).toFixed(2)+"'"),ie(o,.5*r.width,r.height-24+13+2,0,(e.plane.size.x/30.48).toFixed(2)+"'"),ie(o,9,.5*r.height,.5*Math.PI,(e.plane.size.y/30.48).toFixed(2)+"'"),ie(o,r.width-24,.5*r.height,.5*Math.PI,(e.plane.size.y/30.48).toFixed(2)+"'");e.holes.forEach(t=>{a=24+t.position.x,s=r.height-(24+t.position.y),o.strokeRect(a,s,t.size.x,t.size.y),(n=r.height-24-(s+t.size.y))>2&&(te(o,a+.5*t.size.x,s+t.size.y,a+.5*t.size.x,r.height-24-6,6),ie(o,a+.5*t.size.x,s+t.size.y+.5*n,.5*Math.PI,(n/30.48).toFixed(2)+"'")),ie(o,a,s+.5*t.size.y,.5*Math.PI,(t.size.y/2.54).toFixed(1)+'"'),ie(o,a+.5*t.size.x,s+t.size.y,0,(t.size.x/2.54).toFixed(1)+'"'),o.textAlign="center",o.textBaseline="bottom";let i=e.findNearestHoles(t);i.left||(n=a-24)>2&&(te(o,a,s+.5*t.size.y,30,s+.5*t.size.y,6),o.fillText((n/30.48).toFixed(2)+"'",24+.5*n,s+.5*t.size.y)),i.right?(n=i.right.position.x+24-(a+t.size.x))>2&&(te(o,a+t.size.x,s+.5*t.size.y,i.right.position.x+24-6,s+.5*t.size.y,6),o.fillText((n/30.48).toFixed(2)+"'",a+t.size.x+.5*n,s+.5*t.size.y)):(n=r.width-24-(a+t.size.x))>2&&(te(o,a+t.size.x,s+.5*t.size.y,r.width-24-6,s+.5*t.size.y,6),o.fillText((n/30.48).toFixed(2)+"'",a+t.size.x+.5*n,s+.5*t.size.y))});let h=document.createElement("a");h.href=r.toDataURL("image/jpeg",1),h.download=`stage_${t}_wall_${i}.jpeg`,document.body.appendChild(h),h.click()}),this.defaultStageHeight=i||this.defaultStageHeight,this.defaultStageCount=a||this.defaultStageCount,this.defaultMaterial=r||this.defaultMaterial,this.stagesCount=this.defaultStageCount,this.width=e||this.width,this.depth=t||this.depth;for(let e=0;e<this.defaultStageCount;e++){let t=new X(this.width,this.defaultStageHeight,this.depth,this.defaultMaterial);t.number=e,t.position.y=e*this.defaultStageHeight,this.stages.push(t),this.add(t)}this._updateWalls(),this.roof=new Q(this.width,this.depth),this.add(this.roof),this._updateOverallHeight(),window.addEventListener("mouseup",()=>{this.selectMode===G&&this._finishDrag()}),window.addEventListener("drop",()=>{this.selectMode===G&&this._finishDrag()})}}var se=ae;class ne extends V.a{get canvas(){return this.renderer.domElement}constructor(){super(),s()(this,"scene",new n.Scene),s()(this,"renderer",new n.WebGLRenderer({antialias:!0})),s()(this,"camera",new n.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,999999)),s()(this,"controls",new D(this.camera,this.renderer.domElement)),s()(this,"sky",new L),s()(this,"sun",new P),s()(this,"building",new se),s()(this,"mouse",new n.Vector2),s()(this,"raycaster",new n.Raycaster),s()(this,"walls",[]),s()(this,"parentElement",window),s()(this,"framesToRender",1),s()(this,"shouldRender",()=>{this.framesToRender++}),s()(this,"update",()=>{let[e,t]=[window.innerWidth,window.innerHeight];this.parentElement!==window&&(e=this.parentElement.clientWidth,t=this.parentElement.clientHeight),this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(e,t),this.shouldRender()}),s()(this,"onMouseMove",e=>(this.mouse.x=e.clientX/this.renderer.domElement.clientWidth*2-1,this.mouse.y=-e.clientY/this.renderer.domElement.clientHeight*2+1,this.raycaster.setFromCamera(this.mouse,this.camera),this.building&&(this.building._onMouseMove(this.raycaster),this.shouldRender()),!1)),s()(this,"onMouseDown",()=>(this.building&&(this.building._onMouseDown(this.raycaster),this.shouldRender()),!1)),s()(this,"render",()=>{requestAnimationFrame(this.render),this.framesToRender>0&&(this.framesToRender=0,this.controls.update(),this.renderer.render(this.scene,this.camera))}),s()(this,"createEmptyBuilding",(e,t,i,a,s)=>{this.building&&this.scene.remove(this.building),this.building=new se(R(Math.max(4,e)),R(Math.max(4,t)),R(Math.max(8,i)),a,s),this.scene.add(this.building),this.building.addEventListener(f.b,()=>this.dispatch({type:f.b})),this.controls.clampInstance(this.building,this.sun.dirLight),this.shouldRender()}),s()(this,"getInstance",e=>d.models[e]?d.models[e].clone():null),s()(this,"getMaterial",e=>d.materials[e]?d.materials[e]:null),s()(this,"setRoofMaterial",e=>{this.building.setRoofMaterial(e),this.shouldRender()}),s()(this,"setStageMaterial",(e,t)=>{this.building.setStageMaterial(e,t),this.shouldRender()}),s()(this,"setStageSelectMode",e=>{this.building.selectMode=e?N:Y,this.building.selectStage(e?this.building.selectedStage:null)}),s()(this,"setStageHeight",(e,t)=>{e.setHeight(R(t)),this.building._updateWalls(),this.building._updateOverallHeight(),this.building.selectStage(e),this.shouldRender()}),s()(this,"getStagePlan",e=>{if(!e)return!1;this.building.getWallPlan(e.walls[0],e.number,0),this.building.getWallPlan(e.walls[1],e.number,1),this.building.getWallPlan(e.walls[2],e.number,2),this.building.getWallPlan(e.walls[3],e.number,3)}),re.set(this,{writable:!0,value:()=>{let e=this.sky.material.uniforms;e.turbidity.value=10,e.rayleigh.value=2,e.mieCoefficient.value=.005,e.mieDirectionalG.value=.8,e.luminance.value=1;let t=Math.PI*(.388-.5),i=2*Math.PI*-.25;e.sunPosition.value.x=4e5*Math.cos(i),e.sunPosition.value.y=4e5*Math.sin(i)*Math.sin(t),e.sunPosition.value.z=4e5*Math.sin(i)*Math.cos(t)}}),this.renderer.physicallyCorrectLights=!0,this.renderer.gammaInput=!0,this.renderer.gammaOutput=!0,this.renderer.shadowMap.enabled=!0,this.renderer.toneMapping=n.Uncharted2ToneMapping,this.renderer.toneMappingExposure=2,this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=n.PCFSoftShadowMap,this.render(),this.controls.maxPolarAngle=.45*Math.PI,this.controls.minDistance=T(5e-4),this.controls.maxDistance=T(.1),this.controls.enablePan=!1,this.controls.addEventListener("change",()=>{this.shouldRender()}),this.renderer.domElement.addEventListener("mousemove",this.onMouseMove,!1),this.renderer.domElement.addEventListener("dragover",e=>e.preventDefault(),!1),this.renderer.domElement.addEventListener("dragover",this.onMouseMove,!1),this.renderer.domElement.addEventListener("mousedown",this.onMouseDown,!1),this.renderer.domElement.addEventListener("drop",this.onMouseDown,!1),this.camera.position.set(0,A(1),-A(5)),this.controls.update(),this.sky.scale.setScalar(45e4),this.scene.add(this.sky),this.scene.fog=new n.FogExp2(9411231,5e-5),this.scene.background=d.env,j()(this,re).call(this),this.scene.add(new F),this.scene.add(this.sun),this.scene.add(this.building),this.controls.clampInstance(this.building,this.sun.dirLight),this.building.addEventListener(f.b,()=>this.dispatch({type:f.b}))}}var re=new WeakMap,oe=ne;i.d(t,"getPlane",(function(){return w})),i.d(t,"getBox",(function(){return y})),i.d(t,"setMirrorMaterial",(function(){return x})),i.d(t,"setRoughMaterial",(function(){return M})),i.d(t,"applyMaterial",(function(){return S})),i.d(t,"Sun",(function(){return P})),i.d(t,"Viewer",(function(){return oe})),i.d(t,"THREE",(function(){return n})),i.d(t,"in2cm",(function(){return O})),i.d(t,"ft2cm",(function(){return R})),i.d(t,"m2cm",(function(){return A})),i.d(t,"km2cm",(function(){return T})),i.d(t,"in2ft",(function(){return _})),i.d(t,"ft2in",(function(){return I})),i.d(t,"Ground",(function(){return F})),i.d(t,"Wall",(function(){return k})),i.d(t,"loadResources",(function(){return g})),i.d(t,"cache",(function(){return d}))}}]);